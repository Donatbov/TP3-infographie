<!DOCTYPE html>
<html lang="en">
<head>
    <title>basic solar system</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="css/basic.css">
    <script src="three.js"></script>
    <script src="js/Detector.js"></script>
    <script type="text/javascript">

        // Checks that your browser supports WebGL.
        if (!Detector.webgl) Detector.addGetWebGLMessage();

        var renderer = null;
        var scene = null;
        var camera = null;
        var sun = null;
        var earth = null;
        var moon = null;
        var solarGroup = null;
        var earthGroup = null;
        var moonGroup = null;
        var curTime = Date.now();

        // This function is called whenever the document is loaded
        function init() {
            // Get display canvas
            var canvas = document.getElementById("webglcanvas");
            console.log(canvas);

            // Create the Three.js renderer and attach it to our canvas
            renderer = new THREE.WebGLRenderer({
                canvas: canvas,
                antialias: true
            });
            // Set the viewport size
            renderer.setSize(canvas.width, canvas.height);
            // Create a new Three.js scene
            scene = new THREE.Scene();
            // Add a camera so we can view the scene
            camera = new THREE.PerspectiveCamera(45, canvas.width / canvas.height, 1, 4000);
            camera.position.y = 25;
            camera.lookAt(0,-1,0);


            // Create Earth
            // First, create the texture map
            var earthMapUrl = "images/earth_atmos_2048.jpg";
            var earthMap = new THREE.TextureLoader().load(earthMapUrl);

            // Now, create a Basic material; pass in the map
            var earthMaterial = new THREE.MeshPhongMaterial({map: earthMap});

            // Create the earth geometry
            var earthGeometry = new THREE.SphereGeometry(1, 30, 30);

            // And put the geometry and material together into a mesh
            earth = new THREE.Mesh(earthGeometry, earthMaterial);

            // Set earth inclinaison
            earth.rotation.y = Math.PI / 5;
            earth.rotation.x = Math.PI / 5;

            earth.position.x = 10;

            var earthAxis = new THREE.AxesHelper(5);
            earth.add(earthAxis);


            // Create Sun
            var sunMapUrl = "images/8k_sun.jpg";
            var sunMap = new THREE.TextureLoader().load(sunMapUrl);

            // Now, create a Basic material; pass in the map
            var sunMaterial = new THREE.MeshBasicMaterial({map: sunMap});

            // Create the earth geometry
            var sunGeometry = new THREE.SphereGeometry(3, 30, 30);

            // And put the geometry and material together into a mesh
            sun = new THREE.Mesh(sunGeometry, sunMaterial);

            var worldAxis = new THREE.AxesHelper(5);
            sun.add(worldAxis);

            // Add a white point light
            light = new THREE.PointLight(0xffffff, 1.5);



            // Create Moon
            var mapMoonUrl = "images/moon_1024.jpg";

            var mapMoon = new THREE.TextureLoader().load(mapMoonUrl);

            var materialMoon = new THREE.MeshPhongMaterial({map: mapMoon});

            var geometryMoon = new THREE.SphereGeometry(0.5, 30, 30);

            moon = new THREE.Mesh(geometryMoon, materialMoon);
            moon.position.x = 2;

            var moonAxis = new THREE.AxesHelper(5);
            moon.add(moonAxis);


            // Add objects into groups
            solarGroup = new THREE.Group();
            earthGroup = new THREE.Group();
            moonGroup =  new THREE.Group();
            moonGroup.position.x = 10; // Pareil que la terre

            // Finally, add the groups to our scene
            moonGroup.add(moon);
            earthGroup.add(moonGroup);
            earthGroup.add(earth);
            solarGroup.add(earthGroup);
            solarGroup.add(sun);
            scene.add(solarGroup);
            scene.add(light);

        }

        // This function is called regularly to update the canvas webgl.
        function run() {
            // Ask to call again run
            requestAnimationFrame(run);

            // Render the scene
            render();

            // Calls the animate function if objects or camera should move
            animate();
        }

        // This function is called regularly to take care of the rendering.
        function render() {
            // Render the scene
            renderer.render(scene, camera);
        }

        // This function is called regularly to update objects.
        function animate() {
            // Computes how time has changed since last display
            var now = Date.now();
            var deltaTime = now - curTime;
            curTime = now;
            var fracTime = deltaTime / 1000; // in seconds
            // Now we can move objects, camera, etc.
            // Example: rotation earth
            var angle = Math.PI * 2 * fracTime; // one turn per second.
            sun.rotation.y         += angle / 27;     // le soleil tourne sur lui même en environ 27 jours
                                                      // (nb en réalité c'est plus complexe, il tourne plus il tourne plus rapidement à l'équateur qu'aux pôles)
            earthGroup.rotation.y += angle / 365;     // la terre tourne en 365 jours
            earth.rotation.y      += angle;           // et en un jour sur elle-même
            moonGroup.rotation.y  += angle / 28;      // la lune tourne en 28 jours autour de la terre
            //moon.rotation.y       -= angle /28;       // et en 28 jours aussi sur elle-même pour faire face à la terre
            // (nb, ici on en a pas besoin car tout est relatif)
        }

    </script>
</head>
<body>
<div id="info"> a first three.js example</div>
<canvas id="webglcanvas" style="border: none;background-color:#000000"
        width="1400" height="900"></canvas>
<!-- We run the WebGL code at the end to be sure that the document is loaded.
  -->
<script>
    init();
    run();
</script>
</body>
</html>

